From 572d7a3f8599d90ffd73bf32f77b00124a2dc34d Mon Sep 17 00:00:00 2001
From: unknown <nephesh@.(none)>
Date: Tue, 26 Jan 2010 21:17:47 -0600
Subject: [PATCH 2/2] AssignmentBlockNode

---
 IronJS/Compiler/Ast/AssignmentBlockNode.cs |   17 +++++++++++++++++
 IronJS/Compiler/AstGenerator.cs            |    8 ++++----
 IronJS/IronJS.csproj                       |    1 +
 3 files changed, 22 insertions(+), 4 deletions(-)
 create mode 100644 IronJS/Compiler/Ast/AssignmentBlockNode.cs

diff --git a/IronJS/Compiler/Ast/AssignmentBlockNode.cs b/IronJS/Compiler/Ast/AssignmentBlockNode.cs
new file mode 100644
index 0000000..be1e666
--- /dev/null
+++ b/IronJS/Compiler/Ast/AssignmentBlockNode.cs
@@ -0,0 +1,17 @@
+ï»¿using System;
+using System.Collections.Generic;
+using System.Linq;
+using System.Text;
+
+namespace IronJS.Compiler.Ast
+{
+    public class AssignmentBlockNode : BlockNode
+    {
+        public bool IsLocal { get; protected set; }
+        public AssignmentBlockNode(List<Node> nodes, bool isLocal)
+            : base(nodes)
+        {
+            IsLocal = isLocal;
+        }
+    }
+}
diff --git a/IronJS/Compiler/AstGenerator.cs b/IronJS/Compiler/AstGenerator.cs
index 2b74724..fd8145d 100644
--- a/IronJS/Compiler/AstGenerator.cs
+++ b/IronJS/Compiler/AstGenerator.cs
@@ -461,8 +461,8 @@ namespace IronJS.Compiler
 
         private Node BuildCommaExpression(ITree node)
         {
-            return new BlockNode(
-                node.Map(x => Build(x))
+            return new AssignmentBlockNode(
+                node.Map(x => Build(x)), false
             );
         }
 
@@ -765,7 +765,7 @@ namespace IronJS.Compiler
 
             for (int i = 0; i < node.ChildCount; ++i)
             {
-                var assignNode = Build(node.GetChildSafe(0));
+                var assignNode = Build(node.GetChildSafe(i));
 
                 if (assignNode is AssignNode)
                 {
@@ -778,7 +778,7 @@ namespace IronJS.Compiler
                 nodes.Add(assignNode);
             }
 
-            return new BlockNode(nodes);
+            return new AssignmentBlockNode(nodes, true);
         }
 
         private Node BuildObject(ITree node)
diff --git a/IronJS/IronJS.csproj b/IronJS/IronJS.csproj
index b12853e..d72b25b 100644
--- a/IronJS/IronJS.csproj
+++ b/IronJS/IronJS.csproj
@@ -54,6 +54,7 @@
     <Reference Include="System.Xml" />
   </ItemGroup>
   <ItemGroup>
+    <Compile Include="Compiler\Ast\AssignmentBlockNode.cs" />
     <Compile Include="Compiler\Ast\AssignNode.cs" />
     <Compile Include="Compiler\Ast\AutoPropertyNode.cs" />
     <Compile Include="Compiler\Ast\BlockNode.cs" />
-- 
1.6.4.msysgit.0

